graph TD
    %% MCP SYSTEM - Complete Architecture
    %% Generated by LangGraph Studio Export Manager
    
    %% Styling
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:3px,color:#fff
    classDef reasoning fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#fff
    classDef execution fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#fff
    classDef evaluation fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#fff
    classDef decision fill:#fce4ec,stroke:#880e4f,stroke-width:2px,color:#fff
    classDef memory fill:#f1f8e9,stroke:#33691e,stroke-width:2px,color:#fff
    classDef llm fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#fff
    
    %% Main Flow Nodes
    START([ğŸš€ START]):::startEnd
    INIT[ğŸ”§ Initialize Session<br/>ğŸ“‹ Config & Memory]:::memory
    HEALTH[â¤ï¸ Health Check<br/>ğŸ” System Status]:::evaluation
    REASON[ğŸ§  Enhanced Reasoning<br/>ğŸ“ Task Analysis & Planning]:::reasoning
    SELECT[ğŸ¯ Adaptive Selection<br/>ğŸ¤– Auto-detect Best Model]:::decision
    EXECUTE[âš¡ Execute LLM<br/>ğŸ”¥ Local Models + Langwatch]:::llm
    EVALUATE[ğŸ“Š Enhanced Reward<br/>ğŸ† Multi-dimensional Scoring]:::evaluation
    CONTRADICTION[ğŸ”¥ Contradiction Analysis<br/>ğŸ’¡ Failure Detection & Learning]:::decision
    RETRY[ğŸ”„ Intelligent Retry<br/>ğŸ² Strategy Selection]:::decision
    FINALIZE[âœ… Finalize Results<br/>ğŸ’¾ Save & Cleanup]:::memory
    END([ğŸ END]):::startEnd
    
    %% Local LLM Nodes
    MISTRAL[ğŸ§™â€â™‚ï¸ Mistral Local<br/>General Reasoning]:::llm
    LLAMA[ğŸ¦™ LLaMA Local<br/>Text Generation]:::llm
    DEEPSEEK[ğŸ”¬ DeepSeek Local<br/>Math & Logic]:::llm
    
    %% Main Flow
    START --> INIT
    INIT --> HEALTH
    HEALTH --> REASON
    REASON --> SELECT
    SELECT --> EXECUTE
    EXECUTE --> EVALUATE
    EVALUATE --> CONTRADICTION
    CONTRADICTION --> RETRY
    RETRY --> FINALIZE
    FINALIZE --> END
    
    %% Model Selection Flow
    SELECT -.->|Math/Logic| DEEPSEEK
    SELECT -.->|General| MISTRAL
    SELECT -.->|Text Gen| LLAMA
    DEEPSEEK -.-> EXECUTE
    MISTRAL -.-> EXECUTE
    LLAMA -.-> EXECUTE
    
    %% Conditional Edges
    HEALTH -->|âŒ System Unhealthy| END
    EVALUATE -->|â­ Score >= 0.8| FINALIZE
    EVALUATE -->|ğŸ“‰ Score < 0.8| CONTRADICTION
    CONTRADICTION -->|ğŸ”¥ Apply Contradiction| REASON
    CONTRADICTION -->|âœ… No Contradiction Needed| RETRY
    RETRY -->|ğŸ”„ Retry with Same Model| SELECT
    RETRY -->|ğŸ”€ Try Different Model| SELECT
    RETRY -->|ğŸ›‘ Max Retries Reached| FINALIZE
    
    %% Langwatch Integration (invisible connections)
    EXECUTE -.->|ğŸ“Š Track Metrics| EVALUATE
    CONTRADICTION -.->|ğŸ“ˆ Effectiveness Analysis| RETRY
    
    %% Metadata
    %% Total Nodes: 14
    %% Total Edges: 16
    %% Features: Reasoning, Reward, Contradiction, Retry, Memory, Local LLMs, Langwatch
    %% Models: Mistral, LLaMA, DeepSeek (.gguf format)
    %% Monitoring: Real-time debugging, Session tracking, Performance metrics
